# üß† Infra: The Agentic Workflow Coordinator

This repository is the central orchestration unit for an automated, agent-ready GitHub ecosystem. it serves as the "Senior Architect" and "DevOps Lead" for all other projects in this workspace.

## üèóÔ∏è Core Components

### 1. The Infra Planner (`planner.py`)
A state-of-the-art repository auditor. It scans target repositories and generates a **Modernization Roadmap** (`ROADMAP.md`) based on 2025 SOTA standards.
- **Priority One:** Enabling "Parallel Agent Workflows" via Worktrunk.
- **Standards:** Enforces `uv` for dependency management, strict `mypy` typing, and automated CI/CD.

### 2. Global Code Review Standards (`GEMINI.md`)
The "source of truth" for all AI agents.
- **Centralized:** Other repositories (like `WebScraper`) fetch these rules dynamically during CI runs.
- **Governance:** Mandates PR-only workflows and write-protected `main` branches to ensure a clean, stable codebase even with multiple agents working in parallel.

### 3. Automated Reviewer (`.github/workflows/reviewer.yml`)
A reusable GitHub Action that triggers Gemini-powered code reviews on every Pull Request.
- **Critical Blocking:** Automatically blocks merges if "Bug Risk" or "Security" issues are detected.
- **Solo-Friendly:** Allows self-merging once automated checks are green, removing bottlenecks for solo developers.

## üîÑ The "Agent Loop" Workflow

This ecosystem is designed to be used with **Worktrunk** to allow 5-10 AI agents to work in parallel without git lock conflicts.

1.  **Plan:** Run `uv run planner.py` to see what needs to be built.
2.  **Branch:** Use Worktrunk to create an isolated environment:
    ```bash
    wt add feature/new-logic
    ```
3.  **Work:** Let the Agent (Claude Code, Cursor, etc.) work inside the worktree folder (`../repo.feature-new-logic`).
4.  **Verify:** The Agent runs `uv run ruff check .` and `uv run mypy .` locally.
5.  **Submit:** The Agent pushes to a branch and opens a PR.
6.  **Review:** GitHub Actions run the **CI** (lint/type-check) and **AI Reviewer** (fetching rules from this repo).
7.  **Merge:** Once checks are green, merge the PR and cleanup:
    ```bash
    wt merge feature/new-logic
    wt remove feature/new-logic
    ```

## üõ†Ô∏è Setup

1.  **Dependencies:**
    ```bash
    uv sync --extra dev
    ```
2.  **Configuration:**
    Ensure `GEMINI_API_KEY` is set in your environment.
3.  **Standards:**
    All code in this repo must pass:
    ```bash
    uv run ruff check .
    uv run mypy .
    ```

---
*Generated by the Infra Planner ‚Äî Automating the workflow from the inside out.*

## ü§ñ Agentic Workflow Setup

This project uses an **Orchestrator-Executor** model for AI-assisted development across multiple repositories.

### 1. High-Level Planning
The `infra/planner.py` script acts as the "Brain". It scans a target repository and generates a `ROADMAP.md` which acts as the backlog for feature-level agents.
- **Run Planner:**
  ```bash
  cd infra
  TARGET_REPO="../<repo-name>" .venv/bin/python3 planner.py
  ```

### 2. Global Standards
Global AI instructions are maintained in `infra/GEMINI.md`. All sub-repositories contain a local `GEMINI.md` that links to this coordinator. This ensures all agents (no matter which repo they boot in) follow the same security and coding standards.

### 3. Execution with gemini-cli
To work on multiple repos simultaneously or perform cross-repo tasks:
- **Boot in Parent Directory:** Boot `gemini-cli` in the directory containing all your project folders.
  ```bash
  cd Documents/personal-repos
  gemini-cli --allow-shell --allow-read --allow-write
  ```
- **Focused Feature Work:** Boot `gemini-cli` inside the specific repository.

### 4. Parallel Agents with Worktrees
Use `worktrunk` (`wt`) to manage git worktrees. This allows multiple agents to work on separate branches in separate folders without git lock conflicts.
- **Example:** `wt add my-new-feature`

### 5. Review Loop
Agents can read PR reviews provided by the `review-action` using the GitHub CLI:
```bash
gh pr view <pr-number> --comments
```
